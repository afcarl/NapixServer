#!/usr/bin/env python
# -*- coding: utf-8 -*-

# FIXME : dire que c'est l'application a lancer avec bottle.
# Mettre un exemple de ligne de commande

import logging

logging.basicConfig(filename='/tmp/napix.log', filemode='w', level=logging.DEBUG)
logging.getLogger('Rocket.Errors').setLevel(logging.INFO)

try:
    import napixd
except ImportError:
    import sys, os
    sys.path.append( os.path.realpath( os.path.join( os.path.dirname(__file__), '..' )))

import bottle
from napixd.executor.bottle_adapter import RocketAndExecutor
from napixd.loader import get_bottle_app
from napixd.conf import Conf

if __name__ == '__main__':
    logger = logging.getLogger('Napix.Server')

    #Get the napix bottle
    napixapp = get_bottle_app()
    #get the settings of the daemon
    settings = dict( Conf.get_default().get('Napix.daemon'))

    bottle.debug(settings.get('debug',False))
    logger.info('Starting')

    #run the daemon
    bottle.run(napixapp, host=settings.get('host','127.0.0.1'),
            port=settings.get('port',8002), server=RocketAndExecutor)

    logger.info('Stopping')

