<!DOCTYPE html>
<html>
    <head>
        <title>Napix Web Help</title>
        <link href="../css/help.css" rel="stylesheet"/>
        <style>
            body {
                margin-top: 100px;
                margin-bottom: 200px;
            }
        </style>
    </head>
    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a href="." class="brand" >Napix Help</a>
                    <ul class="nav">
                        <li> <a href="high_level.html">Writing a Napix module</a> </li>
                        <li> <a href="low_level.html">Low level interface</a> </li>
                        <li> <a href="deploy.html">Deployment</a> </li>
                        <li> <a href="executor.html">Process and threads</a> </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="container">
            <h1>Install and deploy Napix</h1>
            <h2>Dependencies</h2>
            <p>
            The napix daemon needs
            <dl>
                <dt>bottle &gt; 0.10 </dt>
                <dd>Lightweight web framework</dd>
                <dt>rocket</dt>
                <dd>Threaded wsgi server</dd>
                <dt>httplib2</dt>
                <dd>Http client</dd>
                <dt>redis-python (optional) </dt>
                <dd>Redis client (for the shared store)</dd>
                <dt>unittest2 (optional) </dt>
                <dd>Test framework (for the unit tests)</dd>
            </dl>
            </p>
            <h2>Configuration</h2>
            <p>
            Napix takes its configuration in the <strong>conf/settings.json</strong>
            </p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;_napix_version&quot;</span><span class="o">:</span> <span class="mf">1.0</span> <span class="p">,</span>
  <span class="s2">&quot;Napix&quot;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;daemon&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;host&quot;</span> <span class="o">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;port&quot;</span> <span class="o">:</span> <span class="mi">8002</span><span class="p">,</span>
      <span class="s2">&quot;debug&quot;</span> <span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="s2">&quot;storage&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;file&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span> <span class="o">:</span> <span class="s2">&quot;/tmp/napix&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;redis&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;host&quot;</span> <span class="o">:</span> <span class="s2">&quot;redis.napix.nx&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;auth&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;auth_url&quot;</span> <span class="o">:</span> <span class="s2">&quot;http://auth.napix.nx/auth/authorization/&quot;</span><span class="p">,</span>
      <span class="s2">&quot;service&quot;</span> <span class="o">:</span> <span class="s2">&quot;localhost:8002&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
            <h3>Napix.daemon</h3>
            <p>
            The Napix.daemon key sets the listen address and port.
            </p>
            <h3>Napix.auth</h3>
            <p>
            The Napix.auth key sets the value of the authentication server.
            The value <em>service</em> is the <strong>public address</strong> at which the Napix server is accessed.
            The client will sign its request with this public address.
            The Napix server will check that it is the host at which the request is addressed by comparing its host value and the request host.
            </p>
            <p>
            The <em>auth_url</em> value will set the address at which the server will ask for the confirmation of the requests authenticity.
            </p>
            <h2>Launch</h2>
            <p>
<div class="highlight"><pre>
$ napixd
Bottle server starting up (using RocketAndExecutor())...
Listening on http://0.0.0.0:8002/
Hit Ctrl-C to quit.
</pre></div>
            </p>
            <h2>Modules Loading</h2>
            <h3>Loading by the configuration</h3>
            <p>
            The configuration object <strong>Napix.managers</strong> is a hashmap
            where the keys are an alias and the value is the dotted python path to a Manager.
            Multiple instance of a single manager class can be loaded, with different aliases.
            The detect (cf <em>Auto-loading</em>) classmethod is not called.
            </p>
            <p>
            In order to specify the configuration for an instance of a Manager,
            you can add a value in the root object of the configuration.
            </p>
            <div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;Napix&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;managers&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;router1&quot;</span> <span class="o">:</span> <span class="s2">&quot;enix.managers.routers.ManagerForX480&quot;</span><span class="p">,</span>
            <span class="s2">&quot;router2&quot;</span> <span class="o">:</span> <span class="s2">&quot;enix.managers.routers.ManagerForX480&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;router1&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;ip&quot;</span> <span class="o">:</span> <span class="s2">&quot;10.20.40.254&quot;</span><span class="p">,</span>
        <span class="s2">&quot;login&quot;</span> <span class="o">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span> <span class="o">:</span> <span class="s2">&quot;wE%RZ34$mm&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;router2&quot;</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;ip&quot;</span> <span class="o">:</span> <span class="s2">&quot;10.20.45.254&quot;</span><span class="p">,</span>
        <span class="s2">&quot;login&quot;</span> <span class="o">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span> <span class="o">:</span> <span class="s2">&quot;mp2*SD16$p&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
            <p>
            In this example, two X480 are managed by this Napix server, they use the same manager, and different IP and credentials.
            </p>
            <h3>Auto-loading</h3>
            <p>
            If there is a file ending by <strong>.py</strong> in a auto-detect folder
            of the napix setup (/var/lib/napix/auto or NapixServer/auto),
            the Napix loader will import this python file and add all the subclasses of Manager in the available managers.
            The auto loaded managers may override the classmethod <strong>detect</strong>
            that return if the managers should be loaded.
            By default detect return True when the class is not a base method defined inside Napix.
            </p>
            <div class="highlight"><pre><span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">from</span> <span class="nn">napixd.managers</span> <span class="kn">import</span> <span class="n">Manager</span>

<span class="k">class</span> <span class="nc">AvailableOnLinuxOnly</span><span class="p">(</span><span class="n">Manager</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Linux&#39;</span>
</pre></div>
            <p>
            This feature does not allow multiple loading of the same manager neither the configuration.
            </p>
        </div>
    </body>
</html>
