require.config({paths:{order:"libs/order",bootstrap:"bootstrap.min",jQuery:"libs.min",underscore:"libs.min",Backbone:"libs.min",jsSHA:"libs.min",localstorage:"libs.min",selecteditem:"libs.min","json/editor":"json.min","json/viewer":"json.min","models/consoleentries":"models.min","models/history":"models.min","models/credentials":"models.min","models/servers":"models.min",napix:"napix.min",napixclient:"napix.min","libs/backbone/backbone":"libs/backbone.min","libs/underscore/underscore":"libs/underscore.min",
"libs/jquery/jquery":"libs/jquery.min","libs/jssha/sha256":"libs/sha256.min",selectors:"app.min",explorer:"app.min","napix-ui":"app.min",console:"app.min",consoleactions:"app.min"}});define("main",["Backbone","jQuery","napix-ui"],function(e,a,c){a(document).ready(function(){new c;e.history.start()})});require(["main"]);
define("explorer","Backbone,jQuery,underscore,napixclient,json/viewer,json/editor".split(","),function(e,a,c,d,f,g){var j=e.View.extend({tagName:"div",initialize:function(b,a){this.path=b;this.parentMetaData=a;c.isNull(a)?d.getLevel(this.path,this.gotMetaData.bind(this)):c.isString(a)?d.getLevel(a+"/"+this.path.split("/").pop(),this.gotMetaData.bind(this)):a.direct_plug==true?d.getGenericLevel(this.path,this.gotMetaData.bind(this)):a.direct_plug==false&&c.defer(this.gotMetaData.bind(this,a.absolute_url))},
render:function(){a("<div />",{"class":"explorer-header"}).append(a("<i />",{"class":"deploy"})).append(a("<span />",{text:this.path,"class":"path"}).click(this.selectObject.bind(this))).appendTo(this.el);return this},getList:function(){d.GET(this.path+"/",this.gotList.bind(this))},gotList:function(b){var a=this.$(".explorer-content").first().empty();this.$(".deploy").first().addClass("icon-minus");this.contentViews=c(b).chain().filter(function(b){return b.search("/_napix")==-1}).map(function(b){b=
new j(b,this.metaData);b.bind("select",this.refire,this);a.append(b.render().el);return b},this).map(function(b){return[b.path,b]}).objectify().value();this.trigger("gotList",this.contentViews);this.unbind("gotList")},gotMetaData:function(b){this.metaData=b||null;a("<div />",{"class":"explorer-content"}).appendTo(this.el);this.$(".deploy").first().addClass("icon-plus").click(this.toggleContent.bind(this));this.trigger("gotMetaData");this.unbind("gotMetaData")},getObject:function(){c.isString(this.parentMetaData)?
this.gotObject():d.GET(this.path,this.gotObject.bind(this))},gotObject:function(b){if(b)this.object=b;this.trigger("select",this)},selectObject:function(){if(c.isUndefined(this.object)){this.object=null;this.getObject()}else this.gotObject()},toggleContent:function(b){if(this.filled)if(c.isBoolean(b)){this.$(".explorer-content").first().toggle(b);this.$(".deploy").first().addClass(b?"icon-plus":"icon-minus")}else{b=this.$(".explorer-content").first().toggle().css("display")=="none";this.$(".deploy").first().addClass(b?
"icon-plus":"icon-minus").removeClass(b?"icon-minus":"icon-plus")}else{this.filled=true;this.getList()}},refire:function(b){this.trigger("select",b)},setSelected:function(b){this.$(".explorer-header").first().toggleClass("selected",b)},refreshObject:function(){delete this.object;this.selectObject()},refreshContent:function(){this.filled=false;this.toggleContent()},goToPath:function(b){if(this.path==b)this.selectObject();else if(b.search(this.path)==0){this.metaData?this.toggleContent(true):this.bind("gotMetaData",
this.toggleContent.bind(this));var a=function(a){c.any(a,function(a,c){if(b.search(c)==0){a.goToPath(b);return true}return false})};this.contentViews?a(this.contentViews):this.bind("gotList",a)}}}),i=e.View.extend({initialize:function(){this.deployed=false},render:function(){this.$el.append(a("<div />",{text:"/"}).one("click",this.deploy.bind(this))).append(a("<div />",{"class":"explorer-content"}));return this},goToPath:function(b){this.deploy();var a=function(a){c.any(a,function(a,c){if(b.search(c)==
0){a.goToPath(b);return true}return false})};this.views?a(this.views):this.bind("gotList",a)},deploy:function(){if(!this.deployed){d.GET("/",this.gotList.bind(this));this.deployed=true}},gotList:function(b){var a=this.$(".explorer-content");this.views=c(b).chain().map(function(b){b=new j(b,null);b.bind("select",this.refire,this);a.append(b.render().el);return b},this).map(function(b){return[b.path,b]}).objectify().value();this.trigger("gotList",this.views);this.unbind("gotList")},refire:function(b){this.trigger("select",
b)}}),h=e.View.extend({tagName:"em",render:function(){this.$el.text("empty");return this}}),h=e.View.extend({id:"",emptyView:h,initialize:function(){this.setElement(a("#"+this.id));this.rendered=this.shown=false;this.view=new this.emptyView;a("#"+this.id+"-label").bind("shown",this.show.bind(this)).bind("hidden",this.hide.bind(this))},gotObject:function(b){this.rendered=false;this.view=b?new this.insideView(b):new this.emptyView;return this.render()},render:function(){if(!this.rendered&&this.shown){this.rendered=
true;this.actuallyRender()}return this},actuallyRender:function(){this.$el.empty().append(this.view.render().el);this.trigger("rendered",this.view)},available:function(b){a("#"+this.id+"-label").toggle(Boolean(b));if(!b)this.shown=false},hide:function(){this.shown=false;return this},show:function(){this.shown=true;this.render();return this}}),k=h.extend({id:"explorer-object",insideView:f,gotObject:function(b,a){this.path=a.path;this.actions=a.actions;this.deletable=a.deletable;this.editable=a.editable;
k.__super__.gotObject.call(this,b);return this},actuallyRender:function(){k.__super__.actuallyRender.call(this);var b=a("<div />",{id:"explorer-object-actions","class":"btn-group"}).appendTo(this.el);this.actions&&c.each(this.actions,function(i){a("<button />",{text:i,"class":"btn"}).click(c.bind(this.trigger,this,"action",i,this.path)).appendTo(b)},this);this.deletable&&a("<button />",{text:"Delete","class":"btn btn-danger"}).click(c.bind(this.trigger,this,"delete",this.path)).appendTo(b);this.editable&&
a("<button />",{text:"Edit","class":"btn"}).click(c.bind(this.trigger,this,"edit",this.path)).appendTo(b);return this}}),m=h.extend({id:"explorer-help",insideView:f}),l=h.extend({insideView:g,initialize:function(){l.__super__.initialize.call(this);this.bind("rendered",this.onRender,this)},gotObject:function(b,a){this.path=a.path;l.__super__.gotObject.call(this,b)},onRender:function(b){b.bind("validate",c.bind(this.trigger,this,"validate",this.path))}}),n=l.extend({id:"explorer-edit"}),h=e.View.extend({initialize:function(b){this.collectionPath=
b},render:function(){d.getNewObject(this.collectionPath,this.gotTemplate.bind(this));return this},gotTemplate:function(b){b=new g(b);a(this.el).append(b.render().el);b.bind("validate",c.bind(this.trigger,this,"validate"))}}),o=l.extend({id:"explorer-create",insideView:h}),p=e.View.extend({className:"alert alert-info",initialize:function(b,a){this.path=b;this.action=a;this.actionUrl=this.path+"/_napix_action/"+this.action;this.mandatoryView=this.optionnalView=null},render:function(){d.GET(this.actionUrl+
"/_napix_help",this.gotActionMetaData.bind(this));this.$el.empty().append(a("<h3 >",{text:this.path+" - "+this.action})).append(a("<a />",{"class":"close","data-dismiss":"alert",text:"X"}));return this},gotActionMetaData:function(b){var i=c.reduce(b.mandatory,function(b,a){b[a]="";return b},{}),h=a("<div />",{"class":"content json"});if(!c.isEmpty(i)){this.mandatoryView=(new g.defaultView(i)).disableAddKey();h.append(a("<h4 />",{text:"Mandatory parameters"})).append(this.mandatoryView.render().el)}if(!c.isEmpty(b.optional)){this.optionnalView=
(new g.defaultView(b.optional)).disableAddKey();h.append(a("<h4 />",{text:"Optionnal parameters"})).append(this.optionnalView.render().el)}h.append(a("<button />",{text:"Valider","class":"btn validate"}).click(this.validate.bind(this)));this.$el.append(h);this.$("input,button.validate").first().focus()},validate:function(){d.POST(this.actionUrl,this.getValue(),this.gotResult.bind(this))},gotResult:function(b){this.$(".content").empty().append((new f(b)).render().el)},getValue:function(){return c.extend(this.mandatoryView&&
this.mandatoryView.getValue()||{},this.optionnalView&&this.optionnalView.getValue()||{})}});return e.View.extend({initialize:function(){this.setElement(a("#explorer"));this.object=new k;this.help=new m;this.edit=new n;this.create=new o;d.bind("error",this.gotError,this);this.edit.bind("validate",this.sendPUT,this);this.edit.available(false);this.create.bind("validate",this.sendPOST,this);this.object.bind("edit",this.showEdit,this).bind("delete",this.sendDELETE,this).bind("action",this.callAction,
this).show();a('#explorer-tabs a[data-toggle="tab"]').bind("show",this.changeTab.bind(this));d.bind("change",this.selectServer,this);this.rootView=this.currentView=null},changeTab:function(b){a(b.relatedTarget).trigger("hidden")},showEdit:function(){a("#explorer-edit-label").tab("show")},goToPath:function(b){this.rootView?this.rootView.goToPath(b):this.bind("selectServer",function(){this.rootView.goToPath(b)}.bind(this))},gotError:function(b,i,h){a("<div />",{"class":"alert alert-block alert-error"}).append(a("<a />",
{"class":"close","data-dismiss":"alert",text:"X"})).append(a("<h4 />",{"class":"error-msg",text:b+" "+i})).append(c.isString(h)&&a("<span />",{text:h})||!c.isEmpty(h)&&h.jquery&&h||(new f(h)).render().el).prependTo(this.el)},selectServer:function(b){a("#server").text(b.credentials.login+"@"+b.server);this.rootView=new i;this.rootView.bind("select",this.select,this);a("#explorer-server").empty().append(this.rootView.render().el);this.trigger("selectServer");this.unbind("selectServer")},select:function(b){this.currentView!=
null&&this.currentView.setSelected(false);b.setSelected(true);this.create.available(b.metaData&&c.contains(b.metaData.collection_methods,"POST"));this.object.gotObject(b.object,{path:b.path,actions:b.parentMetaData&&b.parentMetaData.actions||[],editable:Boolean(b.parentMetaData&&c.contains(b.parentMetaData.resource_methods,"PUT")),deletable:Boolean(b.parentMetaData&&c.contains(b.parentMetaData.resource_methods,"DELETE"))});this.edit.gotObject(b.object,{path:b.path});this.help.gotObject(b.metaData&&
!c.isString(b.metaData)?b.metaData:b.parentMetaData);this.create.gotObject(b.path,{path:b.path});a("#explorer-object-label").tab("show");this.currentView=b;this.trigger("selected",b.path)},sendPUT:function(b,a){d.PUT(b,a,this.currentView.refreshObject.bind(this.currentView))},sendPOST:function(b,a){console.log("path",b);console.log("object",a);d.POST(b+"/",a,function(){this.currentView.refreshContent();this.alertOk();this.object.show()}.bind(this))},sendDELETE:function(b){d.DELETE(b,c.bind(this.goToPath,
this,b.split("/").slice(0,-1).join("/")))},alertOk:function(){a("<div />",{"class":"alert alert-block alert-info"}).append(a("<a />",{"class":"close","data-dismiss":"alert",text:"X"})).append(a("<h4 />",{text:"Done"})).prependTo(this.el)},callAction:function(b,a){(new p(a,b)).render().$el.prependTo(this.el)}})});
define("console","Backbone,underscore,jQuery,json/viewer,models/history,models/consoleentries,consoleactions".split(","),function(e,a,c,d,f,g,j){var i=e.View.extend({tagName:"div",className:"console-entry-text",render:function(){this.$el.text(this.model.get("text"));return this}}),h=i.extend({tagName:"pre"}),k=e.View.extend({className:"console-entry-query",render:function(){this.$el.append(c("<span />",{text:">>>"})).append(this.model.get("text"));return this}}),m=e.View.extend({render:function(){var a=
this.model.get("text");this.$el.append((new d(a)).render().el);return this}}),l=e.View.extend({initialize:function(a){this.inside=l.getView(a);this.setElement(this.inside.el)},render:function(){this.inside.render();this.$el.addClass("console-entry");return this}},{getView:function(a){return a.get("level")in this.viewsMap?new (this.viewsMap[a.get("level")])({model:a}):new this.defaultView({model:a})},viewsMap:{query:k,help:h,json:m},defaultView:i}),n=e.View.extend({initialize:function(){this.setElement(c("#console-input"));
this.focus();this.keymap=this.getKeyMap();this.$el.keypress(this.onKeyPress.bind(this));c("#console-go").click(this.validate.bind(this));this._historyPosition=-1;this._historyStore=""},getKeyMap:function(){return{13:this.validate,38:this.historyUp,40:this.historyDown}},onKeyPress:function(a){(a=this.keymap[a.keyCode])&&a.call(this)},historyUp:function(){if(f.hasMore(this._historyPosition)){if(this._historyPosition==-1)this._historyStore=this.$el.attr("value");this._historyPosition++;this.$el.attr("value",
f.at(this._historyPosition).get("command"))}},historyDown:function(){if(this._historyPosition!=-1){this._historyPosition--;this._historyPosition==-1?this.$el.attr("value",this._historyStore):this.$el.attr("value",f.at(this._historyPosition).get("command"))}},validate:function(){this._historyPosition=-1;var a=this.$el.attr("value");f.push(a);this.trigger("input",a);this.$el.attr("value","");this.focus()},focus:function(){this.$el.focus()}});return e.View.extend({initialize:function(){this.setElement(c("#console-body"));
g.bind("add",this.addOne,this);g.reset();this._initActions();c("#console-clean").click(this.clear.bind(this));this.prompt_=new n;this.prompt_.bind("input",this.compute,this)},_initActions:function(){this.actions=a.extend({clear:this.clear,help:this.help},j);this.actions.clear.help="Clear the screen";this.actions.help.help="Usage : help [command]\nhelp\n   Show the list of functions\nhelp command\n   Show the help of the given command"},compute:function(c){g.create({level:"query",text:c});tokens=c.split(" ");
if(a.any(tokens))if(tokens[0]in this.actions)(result=this.actions[tokens.shift()].apply(this,tokens))&&g.create({level:"response",text:result});else g.create({level:"notfound",text:'No such method "'+tokens[0]+'"'})},gotJSON:function(a,c){g.create({level:"json",text:c})},addOne:function(a){this.$el.append((new l(a)).render().el);this.$el.scrollTop(this.$el.height())},clear:function(){this.$el.empty();this.show()},help:function(c){c&&c in this.actions?g.create({level:"help",text:this.actions[c].help}):
g.create({level:"json",text:a.keys(this.actions)})},show:function(){this.prompt_.focus()}})});
define("napix-ui","jQuery,Backbone,explorer,console,selectors,bootstrap".split(","),function(e,a,c,d,f){var g=a.View.extend({el:"body",initialize:function(){this.explorer=new c;this.console=new d;this.selectors=new f;e("#explorer-label a").tab("show");e("#console-label a").bind("shown",this.console.show.bind(this.console))}});return a.Router.extend({initialize:function(){this.panels=new g;this.panels.explorer.bind("selected",this.navigate,this)},routes:{console:"showConsole","*path/":"goToPath","*path":"goToPath",
"/":"showConsole"},goToPath:function(a){this.panels.explorer.goToPath(a[0]!="/"&&"/"+a||a)}})});
define("consoleactions",["underscore","napixclient","models/credentials","models/servers"],function(e,a,c,d){var f={},g=function(a,c,e,d){a=new j(a,c,e,d);return a.call.bind(a)},j=function(a,c,e,d){this.filter=c;this.collection=a;this.usage=e;this.callbacks=d};j.prototype={call:function(){result=this.callback.apply(this,arguments);if(!result)return this.usage},searchModel:function(a){return this.collection.find(function(c){return c.get(this.filter)==a},this)||this.collection.find(function(c){return-1!=
c.get(this.filter).search(a)},this)},callback:function(a,c){if(!a&&!c)return!1;var d=c&&a||"choose",f=e.rest(arguments,2);if("add"==d&&c)return f.unshift(c),(this.callbacks.add||this.defaults.add).apply(this,f);var g=this.searchModel(c||a);f.unshift(g);if("choose"==d&&g)return(this.callbacks.choose||this.defaults.choose).apply(this,f);if("del"==d&&g)return(this.callbacks.del||this.defaults.del).apply(this,f)},defaults:{choose:function(a){a.select();return!0},add:function(a){var c={};c[this.filter]=
a;this.collection.create(c).select();return!0},del:function(a){a.destroy();return!0}}};f.login=g(c,"login","Usage: login [add|del|choose] username [password]",{choose:function(a,c){c&&a.get("pass")!=c&&(a.set({pass:c}),a.save());a.select();return!0},add:function(a,d){console.log(a,d);return d?(c.create({login:a,pass:d}).select(),!0):!1}});f.login.help="Usage: login [add|del|choose] login [pass]\nlogin username\nlogin choose login\n  Select the credentials which match login\nlogin choose username pass\n  Update te credentials matching username\nlogin add username pass\n  add the given credentials\nlogin del username\n  remove the credentials matching username";
f.server=g(d,"host","Usage: server [add|del|choose] hostname",{});f.server.help="Usage: server [add|del|choose] hostname\nserver hostname\nserver choose hostname\n  Select the server which match hostname\nserver add hostname\n  add the server at the host <hostname>\nserver del hostname\n  remove the server matching hostname";f.GET=function(c){if(!c)return"Usage: GET url";a.GET(c,e.bind(this.gotJSON,this,c))};f.GET.help=" Send a GET request a the given url";return f});
define("selectors",["underscore","Backbone","jQuery","models/servers","models/credentials"],function(e,a,c,d,f){var g=a.View.extend({tagName:"li",initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.remove,this);this.$el.click(this.model.select.bind(this.model))},remove:function(){this.$el.remove()}}),j=a.View.extend({initialize:function(){this.setElement(c("#"+this.prefix));this.collection.bind("add",this.addOne,this);this.collection.bind("reset",this.addAll,
this);this.hidePrompt();c("#"+this.prefix+"-plus").click(this.showPrompt.bind(this));c("#"+this.prefix+"-prompt").keypress(this.updateOnEnter.bind(this));this.collection.fetch();this.bind("finished",this.hidePrompt,this)},addAll:function(){this.collection.each(this.addOne,this)},addOne:function(a){a.bind("selected",this.select);this.$("#"+this.prefix+"-body").append((new this.ItemView({model:a})).render().el)},hidePrompt:function(){this.$("#"+this.prefix+"-prompt").hide();this.$("#"+this.prefix+"-plus").show()},
showPrompt:function(){this.$("#"+this.prefix+"-prompt").show().first().find("input").attr("value","").focus();this.$("#"+this.prefix+"-plus").hide()},updateOnEnter:function(a){13==a.keyCode?this.addItem():27==a.keyCode&&this.trigger("finished")},addItem:function(){var a=this.collection.create(e(this.$("input").toArray()).chain().map(function(a){return c(a)}).map(function(a){return[a.prop("name"),a.prop("value")]}).objectify().value());a&&(this.trigger("finished"),a.select())}}),i=g.extend({render:function(){this.$el.text(this.model.get("host")).toggleClass("selected",
this.model.get("selected"));return this}}),h=j.extend({collection:d,ItemView:i,prefix:"connections-servers"}),d=g.extend({render:function(){this.$el.text(this.model.get("login")).toggleClass("selected",this.model.get("selected"));return this}}),k=j.extend({collection:f,ItemView:d,prefix:"connections-credentials"});return a.View.extend({initialize:function(){this.serverSelector=new h;this.loginSelector=new k}})});
