define("json/editor",["Backbone","underscore","jQuery","json/viewer"],function(e,a,c,f){var i=e.View.extend({tagName:"em",dataType:"null",initialize:function(b,a){this.originalValue=a},render:function(){this.$el.text("null");return this},getValue:function(){return null}}),k=e.View.extend({tagName:"input",complex:!1,dataType:"boolean",initialize:function(b,a){this.originalValue=a;this.$el.prop("checked",b).prop("type","checkbox")},getValue:function(){return this.$el.prop("checked")}}),h=e.View.extend({tagName:"input",
complex:!1,type:"text",dataType:"string",initialize:function(b,d){this.originalValue=d;this.$el.prop("type",this.type).prop("value",this._choose(b,d)).blur(a.bind(this.trigger,this,"change"))},_choose:function(b,d){var c=this._score(b),e=this._score(d);if(!c&&!e)return"";b=c>=e?b:d;return 0.25<Math.max(c,e)?b:a.first(b)},_score:function(b){if(a.isString(b))return 1;if(a.isNumber(b))return 0.75;if(a.isNull(b)||a.isBoolean(b)||a.isEmpty(b))return 0;a.isArray(b);return 0.25},getValue:function(){return this._getValue()},
_getValue:function(){return this.$el.prop("value")}}),l=h.extend({type:"number",dataType:"number",getValue:function(){return Number(this._getValue())},_score:function(b){return a.isNumber(b)?1:a.isString(b)?0.5:0}}),g=e.View.extend({complex:!0,_choose:function(b,a){var d=this._score(b),c=this._score(a);if(!d&&!c)return[];b=d>=c?b:a;return 0.25==Math.max(d,c)?[b]:b},_score:function(b){return a.isNull(b)||a.isBoolean(b)?0:a.isNumber(b)||a.isString(b)?0.25:a.isArray(b)?0.75+0.25*this.arrayBias:1+0.25*
this.arrayBias},render:function(){a.each(this.valueViews,function(b){c("<li />").append(b.render().el).appendTo(this.el)},this);this.disableAddKey||c("<li />",{text:this.addText,"class":"add-item"}).click(this.addItem.bind(this)).appendTo(this.el);return this},removeKey:function(b){c(b.el).parent(this.$el.children("li")).remove();this.valueViews=a.without(this.valueViews,b)},addItem:function(){var b=this.makeEmptyItem();this.valueViews.push(b);c("<li />").append(b.render().el).insertBefore(this.$el.children(".add-item"))},
makeEmptyItem:function(){return j.getView("")},disableAddKey:function(){this.disabledAddKey=!0;return this}}),d=g.extend({tagName:"ol",dataType:"array",addText:"Add a row",arrayBias:1,initialize:function(b,d){this.originalValue=d;b=this._choose(b,d);this.valueViews=a(b).chain().map(function(b){return j.getView(b)}).map(function(b){b.bind("pop",this.removeKey,this);return b},this).value()},getValue:function(){return a.map(this.valueViews,function(b){return b.getValue()})}}),n=g.extend({tagName:"ul",
dataType:"object",addText:"Add a key",arrayBias:0,initialize:function(b,d){this.originalValue=d;b=this._choose(b,d);this.valueViews=a(b).chain().keys().map(function(a){return new m(a,b[a])}).map(function(b){b.bind("pop",this.removeKey,this);return b},this).value()},makeEmptyItem:function(){return new m("","")},getValue:function(){return a(this.valueViews).chain().map(function(b){return b.getValue()}).objectify().value()}}),o=e.View.extend({tagName:"label",initialize:function(b){this.editView=new h(b);
this.editView.bind("change",this.update.bind(this))},update:function(){this.$el.empty().text(this.editView.getValue())},edit:function(){this.$el.text("").append(this.editView.el).focus()},render:function(){this.$el.dblclick(this.edit.bind(this));""==this.editView.getValue()?this.edit():this.update();return this},getValue:function(){return this.editView.getValue()}}),m=e.View.extend({tagName:"dd",initialize:function(b,a){this.keyView=new o(b);this.valueView=j.getView(a);this.valueView.bind("pop",this.trigger.bind(this,
"pop",this))},render:function(){this.$el.append(c("<dl />").append(this.keyView.render().el).append(":")).append(c("<dt />").append(this.valueView.render().el));return this},getValue:function(){return[this.keyView.getValue(),this.valueView.getValue()]}}),p=e.View.extend({tagName:"div",initialize:function(b){this.view=b.view},dataTypes:function(){return a([["null","null",i],["boolean","bool",k],["number","123",l],["string","abc",h],["array","[ ]",d],["object","{ }",n]]).chain().map(function(b){return[a.first(b),
a.rest(b)]}).objectify().value()}(),render:function(){el=c("<div />",{"class":"json-mte btn-group"}).appendTo(this.el);a.each(this.dataTypes,function(b,d){var e=c("<button />",{text:b[0],"class":"btn btn-mini"}).click(a.bind(this.transpose,this,b[1])).appendTo(el);d==this.view.dataType&&e.addClass("selected")},this);c("<button />",{text:"X","class":"btn btn-danger btn-mini"}).click(this.trigger.bind(this,"pop",this)).appendTo(el);this.$el.addClass("json-multiedit").append(this.view.render().el);return this},
getValue:function(){return this.view.getValue()},disableAddKey:function(){this.view.complex&&this.view.disableAddKey();return this},transpose:function(b){this.view=new b(this.view.getValue(),this.view.originalValue);this.$el.empty();this.render()}}),q=e.View.extend({tagName:"textarea",initialize:function(b){this.value=b},render:function(){this.$el.attr("value",JSON.stringify(this.value,null,4));return this},getValue:function(){return JSON.parse(this.el.value)}}),j=f.extend({className:"json-edit json",
initialize:function(b,a){this.value=b;this.view=null;this.shown="";this.noAddKey=Boolean(a)},getValue:function(){return this.view.getValue()},showText:function(){"text"!=this.shown&&(this.shown="text",this.updateValue(),this.view=new q(this.value),this.updateView())},showBuilder:function(){"builder"!=this.shown&&(this.shown="builder",this.updateValue(),this.view=j.getView(this.value),this.noAddKey&&this.view.disableAddKey(),this.updateView())},updateValue:function(){this.value=this.view?this.view.getValue():
this.value},updateView:function(){this.$(".json-edit-body").empty().append(this.view.render().el)},render:function(){this.$el.append(c("<div />",{"class":"json-edit-header btn-group","data-toggle":"buttons-radio"}).append(c("<button />",{"class":"btn",text:"Text"}).click(this.showText.bind(this))).append(c("<button />",{"class":"btn",text:"Builder"}).button("toggle").click(this.showBuilder.bind(this)))).append(c("<div />",{"class":"json-edit-body"})).append(c("<div />").append(c("<input />",{value:"Valider",
"class":"btn-primary"})).click(this.validate.bind(this)));this.showBuilder();return this},validate:function(){this.trigger("validate",this.getValue())}},{getView:function(b){var a=f._getView.call(this,b);return new p({view:new a(b,b)})},viewsMap:[[a.isBoolean,k],[a.isNull,i],[a.isArray,d],[a.isNumber,l],[a.isString,h]],defaultView:n});return j});
define("json/viewer",["Backbone","underscore","jQuery"],function(e,a,c){var f=e.View.extend({tagName:"span",className:"json-simple",viewName:"simple",complex:!1,initialize:function(a){this.value=""+a},render:function(){this.$el.text(this.value);return this}}),i=f.extend({viewName:"empty",initialize:function(d){this.value="?";a.any([[a.isNull,"null"],[a.isString,"Empty String"],[a.isArray,"Empty Array"],[a.bind(a.identity,a,!0),"Empty Object"]],function(a){return a[0](d)?(this.value=a[1],!0):!1},this)}}),
k=e.View.extend({tagName:"ol",viewName:"array",complex:!0,initialize:function(d){this.listViews=a.map(d,g.getView,g)},render:function(){a.each(this.listViews,function(a){c("<li />").append(a.render().el).appendTo(this.el)},this);return this}}),h=e.View.extend({viewName:"key",complex:!1,tagName:"li",initialize:function(a,c){this.key=a;this.valueView=g.getView(c)},render:function(){this.valueView.complex?c("<dd />").append(c("<dl />",{"class":"json-key",text:this.key})).append(c("<dt />").append(this.valueView.render().el)).appendTo(this.el):
c("<div />").append(c("<span />",{"class":"json-key",text:this.key})).append(" ").append(this.valueView.render().el).appendTo(this.el);return this}}),l=e.View.extend({tagName:"ul",viewName:"object",complex:!0,initialize:function(d){this.keyViews=a.map(a.keys(d),function(a){return new h(a,d[a])})},render:function(){a.each(this.keyViews,function(a){this.$el.append(a.render().el)},this);return this}}),g=e.View.extend({className:"json-object json",tagName:"div",initialize:function(a){this.inside=this.constructor.getView(a)},
render:function(){this.$el.append(this.inside.render().el);return this}},{_getView:function(a){for(x in this.viewsMap)if(this.viewsMap[x][0](a))return this.viewsMap[x][1];return this.defaultView},getView:function(a){return new (this._getView(a))(a)},viewsMap:[[a.isBoolean,f],[a.isNumber,f],[a.isNull,i],[a.isEmpty,i],[a.isString,f],[a.isArray,k]],defaultView:l});return g});
