define("napix",["jQuery","underscore","jsSHA"],function(h,g,i){NapixClient=function(c,b,e){this.server=c;this.credentials={login:b,key:e};return this};g.extend(NapixClient.prototype,{sign:function(c,b){return(new i(c,"ASCII")).getHMAC(b,"ASCII","SHA-256","HEX")},_getAuthorization:function(c,b){var e=this._encodeParams({login:this.credentials.login,nonce:this.getNonce(),host:this.server,path:b,method:c,timestamp:""+Math.floor(Date.now()/1E3)}),f=this.sign(e,this.credentials.key);return e+":"+f},_encodeParams:function(c){tail=
[];for(var b in c)tail.push(b+"="+escape(c[b]));return tail.join("&")},getNonce:function(){return g.map(g.range(8),function(){return(65536*(1+Math.random())|0).toString(16)}).join("")},request:function(c,b,e,f,a){h.ajax({url:"http://"+this.server+b,type:c,data:e&&JSON.stringify(e),dataType:"json",contentType:"application/json",success:f,error:a||this.onError,headers:{Authorization:this._getAuthorization(c,b)}})}});return NapixClient});
define("napixclient",["Backbone","underscore","napix","models/servers","models/credentials"],function(h,g,i,c,b){var e=function(a){this.suffix=a;this._resources={}};e.prototype={getResource:function(a,d){this._resources[a]&&g.isArray(this._resources[a])?this._resources[a].push(d):this._resources[a]?g.defer(d,this._resources[a]):(this._resources[a]=[d],f.GET(a+this.suffix,g.bind(this.gotResource,this,a)))},gotResource:function(a,d){g.each(this._resources[a],function(a){a(d)});this._resources[a]=d},
renew:function(){this._resources={}}};var f={napix:null,_levels:new e("/_napix_help"),_newObjects:new e("/_napix_new"),make:function(){this._levels.renew();this._newObjects.renew();c.selected()&&b.selected()&&(this.napix=new i(c.selected().get("host"),b.selected().get("login"),b.selected().get("pass")),this.trigger("change",this.napix))},GET:function(a,d,b){this.request("GET",a,null,d,b)},HEAD:function(a,d,b){this.request("HEAD",a,null,d,b)},PUT:function(a,d,b,c){this.request("PUT",a,d,b,c)},POST:function(a,
d,b,c){this.request("POST",a,d,b,c)},DELETE:function(a,b,c){this.request("DELETE",a,null,b,c)},request:function(a,b,c,e,f){this.napix.request(a,b,c,e,f||this.onError.bind(this))},onError:function(a){console.log(a);this.trigger("error",a.status,a.statusText,"application/json"==a.getResponseHeader("content-type")&&JSON.parse(a.responseText)||"text/html"==a.getResponseHeader("content-type")&&$(a.responseText)||a.responseText)},getLevel:function(a,b){return this._levels.getResource(a,b)},getNewObject:function(a,
b){return this._newObjects.getResource(a,b)},getGenericLevel:function(a,b){var c=a.split("/");c.pop();c.push("*");return this.getLevel(c.join("/"),b)}};g.extend(f,h.Events);c.bind("select",f.make,f);b.bind("select",f.make,f);return f});
