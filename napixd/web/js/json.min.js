"use strict";define("json/editor",["Backbone","underscore","jQuery","json/viewer","mustache"],function(o,p,e,d,n){var h=o.View.extend({tagName:"em",dataType:"null",initialize:function(s,r){this.originalValue=r},render:function(){this.$el.text("null");return this},getValue:function(){return null}});var g=o.View.extend({tagName:"input",complex:false,dataType:"boolean",initialize:function(s,r){this.originalValue=r;this.$el.prop("checked",s).prop("type","checkbox")},getValue:function(){return this.$el.prop("checked")}});var f=o.View.extend({tagName:"input",complex:false,type:"text",dataType:"string",initialize:function(s,r){this.originalValue=r;this.$el.prop("type",this.type).prop("value",this._choose(s,r)).blur(p.bind(this.trigger,this,"change"))},_choose:function(t,r){var s=this._score(t);var u=this._score(r);if(!s&&!u){return""}t=s>=u?t:r;return Math.max(s,u)>0.25?t:p.first(t)},_score:function(r){if(p.isString(r)){return 1}if(p.isNumber(r)){return 0.75}if(p.isNull(r)||p.isBoolean(r)||p.isEmpty(r)){return 0}if(p.isArray(r)){return 0.25}return 0.25},getValue:function(){return this._getValue()},_getValue:function(){return this.$el.prop("value")}});var k=f.extend({type:"number",dataType:"number",getValue:function(){return Number(this._getValue())},_score:function(r){if(p.isNumber(r)){return 1}if(p.isString(r)){return 0.5}return 0}});var b=o.View.extend({complex:true,_disabledAddKey:false,_choose:function(t,r){var s=this._score(t);var u=this._score(r);if(!s&&!u){return[]}t=s>=u?t:r;return Math.max(s,u)===0.25?[t]:t},addTextTemplate:n.compile('<li class="add-item" ><button class="btn btn-mini">{{ . }}</button></li>'),events:{"click .add-item":"addItem"},_score:function(r){if(p.isNull(r)||p.isBoolean(r)){return 0}if(p.isNumber(r)||p.isString(r)){return 0.25}if(p.isArray(r)){return 0.75+this.arrayBias*0.25}return 1+this.arrayBias*0.25},render:function(r){p.each(this.valueViews,function(s){e("<li />").append(s.render().el).appendTo(this.el)},this);if(!this._disabledAddKey){this.$el.append(this.addTextTemplate(this.addText))}return this},removeKey:function(r){e(r.el).parent(this.$el.children("li")).remove();this.valueViews=p.without(this.valueViews,r)},addItem:function(){var r=this.makeEmptyItem();r.bind("pop",this.removeKey,this);this.valueViews.push(r);e("<li />").append(r.render().el).insertBefore(this.$el.children(".add-item"))},makeEmptyItem:function(){return q.getView("")},disableAddKey:function(){this._disabledAddKey=true;return this}});var a=b.extend({tagName:"ol",dataType:"array",addText:"Add a row",arrayBias:1,initialize:function(s,r){this.originalValue=r;s=this._choose(s,r);this.valueViews=p(s).chain().map(function(t){return q.getView(t)}).map(function(t){t.bind("pop",this.removeKey,this);return t},this).value()},getValue:function(){return p.map(this.valueViews,function(r){return r.getValue()})}});var j=b.extend({tagName:"ul",dataType:"object",addText:"Add a key",arrayBias:0,initialize:function(s,r){this.originalValue=r;s=this._choose(s,r);this.valueViews=p(s).chain().keys().map(function(t){return new l(t,s[t])}).map(function(t){t.bind("pop",this.removeKey,this);return t},this).value()},makeEmptyItem:function(){return new l("","")},getValue:function(){return p(this.valueViews).chain().map(function(r){return r.getValue()}).objectify().value()}});var c=o.View.extend({tagName:"label",initialize:function(r){this.editView=new f(r);this.editView.bind("change",this.update.bind(this))},update:function(){this.$el.empty().text(this.editView.getValue())},edit:function(){this.$el.text("").append(this.editView.el).focus()},render:function(){this.$el.dblclick(this.edit.bind(this));if(this.editView.getValue()===""){this.edit()}else{this.update()}return this},getValue:function(){return this.editView.getValue()}});var l=o.View.extend({tagName:"dd",initialize:function(r,s){this.keyView=new c(r);this.valueView=q.getView(s);this.valueView.bind("pop",this.trigger.bind(this,"pop",this))},render:function(){this.$el.append(e("<dl />").append(this.keyView.render().el).append(":")).append(e("<dt />").append(this.valueView.render().el));return this},getValue:function(){return[this.keyView.getValue(),this.valueView.getValue()]}});var i=o.View.extend({tagName:"div",_disabledAddKey:false,className:"json-multiedit",initialize:function(r){this.view=r.view},dataTypes:{"null":h,bool:g,number:k,string:f,array:a,object:l},template:n.compile('<div class="json-mte btn-group"><button class="btn btn-mini" data-type="null" >null</button><button class="btn btn-mini" data-type="bool" >bool</button><button class="btn btn-mini" data-type="string" >abc</button><button class="btn btn-mini" data-type="number" >123</button><button class="btn btn-mini" data-type="array" >[ ]</button><button class="btn btn-mini" data-type="object" >{ }</button>{{^disableAdd}}<button class="btn btn-mini btn-danger" data-type="pop" >X</button/>{{/disableAdd}}</div>'),events:{"click button[data-type!='pop']":"transpose","click button[data-type='pop']":"pop"},render:function(){var r=e(this.template({disableAdd:this._disabledAddKey})).appendTo(this.el);r.find("[data-type='"+this.view.dataType+"']").addClass("active");this.$el.append(this.view.render().el);return this},pop:function(){this.trigger("pop",this);return false},getValue:function(){return this.view.getValue()},disableAddKey:function(){this._disabledAddKey=true;if(this.view.complex){this.view.disableAddKey()}return this},transpose:function(r){var s=this.dataTypes[r.target.dataset.type];this.view=new s(this.view.getValue(),this.view.originalValue);this.$el.empty();this.render();return false}});var m=o.View.extend({tagName:"textarea",initialize:function(r){this.value=r},render:function(){this.$el.attr("value",JSON.stringify(this.value,null,4));return this},getValue:function(){return JSON.parse(this.el.value)}});var q=d.extend({className:"json-edit json",initialize:function(s,r){this.value=s;this.view=null;this.shown="";this.noAddKey=Boolean(r)},getValue:function(){return this.view.getValue()},showText:function(){if(this.shown==="text"){return}this.shown="text";this.updateValue();this.view=new m(this.value);this.updateView()},showBuilder:function(){if(this.shown==="builder"){return}this.shown="builder";this.updateValue();this.view=q.getView(this.value);if(this.noAddKey){this.view.disableAddKey()}this.updateView()},updateValue:function(){this.value=this.view?this.view.getValue():this.value},updateView:function(){this.$(".json-edit-body").empty().append(this.view.render().el)},template:'<div class="json-edit-header btn-group" data-toggle="buttons-radio" ><button class="btn text">Text</button><button class="btn builder active" >Builder</button></div><div class="json-edit-body"> </div><div><button class="btn btn-primary validate" >Validate</button></div>',events:{"click .text":"showText","click .builder":"showBuilder","click .validate":"validate"},render:function(){this.$el.append(this.template);this.showBuilder();return this},validate:function(){this.trigger("validate",this.getValue())}},{getView:function(r){var s=d._getView.call(this,r);return new i({view:new s(r,r)})},viewsMap:[[p.isBoolean,g],[p.isNull,h],[p.isArray,a],[p.isNumber,k],[p.isString,f]],defaultView:j});return q});"use strict";define("json/viewer",["Backbone","underscore","jQuery"],function(f,h,e){var a=f.View.extend({tagName:"span",className:"json-simple",viewName:"simple",complex:false,initialize:function(j){this.value=String(j)},render:function(){this.$el.text(this.value);return this}});var c=a.extend({viewName:"empty",initialize:function(j){this.value="?";h.any([[h.isNull,"null"],[h.isString,"Empty String"],[h.isArray,"Empty Array"],[h.bind(h.identity,h,true),"Empty Object"]],function(k){if(k[0](j)){this.value=k[1];return true}return false},this)}});var g=f.View.extend({tagName:"ol",viewName:"array",complex:true,initialize:function(j){this.listViews=h.map(j,b.getView,b)},render:function(){h.each(this.listViews,function(j){e("<li />").append(j.render().el).appendTo(this.el)},this);return this}});var d=f.View.extend({viewName:"key",complex:false,tagName:"li",initialize:function(j,k){this.key=j;this.valueView=b.getView(k)},render:function(){if(this.valueView.complex){e("<dd />").append(e("<dl />",{"class":"json-key",text:this.key})).append(e("<dt />").append(this.valueView.render().el)).appendTo(this.el)}else{e("<div />").append(e("<span />",{"class":"json-key",text:this.key})).append(" ").append(this.valueView.render().el).appendTo(this.el)}return this}});var i=f.View.extend({tagName:"ul",viewName:"object",complex:true,initialize:function(j){this.keyViews=h.map(h.keys(j),function(k){return new d(k,j[k])})},render:function(){h.each(this.keyViews,function(j){this.$el.append(j.render().el)},this);return this}});var b=f.View.extend({className:"json-object json",tagName:"div",initialize:function(j){this.inside=this.constructor.getView(j)},render:function(){this.$el.append(this.inside.render().el);return this}},{_getView:function(k){var j;for(j in this.viewsMap){if(this.viewsMap[j][0](k)){return this.viewsMap[j][1]}}return this.defaultView},getView:function(k){var j=this._getView(k);return new j(k)},viewsMap:[[h.isBoolean,a],[h.isNumber,a],[h.isNull,c],[h.isEmpty,c],[h.isString,a],[h.isArray,g]],defaultView:i});return b});