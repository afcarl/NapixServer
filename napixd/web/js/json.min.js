define("json/editor",["Backbone","underscore","jQuery","json/viewer"],function(n,o,e,d){var h=n.View.extend({tagName:"em",dataType:"null",initialize:function(r,q){this.originalValue=q},render:function(){this.$el.text("null");return this},getValue:function(){return null}});var g=n.View.extend({tagName:"input",complex:false,dataType:"boolean",initialize:function(r,q){this.originalValue=q;this.$el.prop("checked",r).prop("type","checkbox")},getValue:function(){return this.$el.prop("checked")}});var f=n.View.extend({tagName:"input",complex:false,type:"text",dataType:"string",initialize:function(r,q){this.originalValue=q;this.$el.prop("type",this.type).prop("value",this._choose(r,q)).blur(o.bind(this.trigger,this,"change"))},_choose:function(s,q){var r=this._score(s);var t=this._score(q);if(!r&&!t){return""}s=r>=t?s:q;return Math.max(r,t)>0.25?s:o.first(s)},_score:function(q){if(o.isString(q)){return 1}if(o.isNumber(q)){return 0.75}if(o.isNull(q)||o.isBoolean(q)||o.isEmpty(q)){return 0}if(o.isArray(q)){return 0.25}return 0.25},getValue:function(){return this._getValue()},_getValue:function(){return this.$el.prop("value")}});var k=f.extend({type:"number",dataType:"number",getValue:function(){return Number(this._getValue())},_score:function(q){if(o.isNumber(q)){return 1}if(o.isString(q)){return 0.5}return 0}});var b=n.View.extend({complex:true,_choose:function(s,q){var r=this._score(s);var t=this._score(q);if(!r&&!t){return[]}s=r>=t?s:q;return Math.max(r,t)==0.25?[s]:s},_score:function(q){if(o.isNull(q)||o.isBoolean(q)){return 0}if(o.isNumber(q)||o.isString(q)){return 0.25}if(o.isArray(q)){return 0.75+this.arrayBias*0.25}return 1+this.arrayBias*0.25},render:function(q){o.each(this.valueViews,function(r){e("<li />").append(r.render().el).appendTo(this.el)},this);if(!this.disableAddKey){e("<li />",{text:this.addText,"class":"add-item"}).click(this.addItem.bind(this)).appendTo(this.el)}return this},removeKey:function(q){e(q.el).parent(this.$el.children("li")).remove();this.valueViews=o.without(this.valueViews,q)},addItem:function(){var q=this.makeEmptyItem();this.valueViews.push(q);e("<li />").append(q.render().el).insertBefore(this.$el.children(".add-item"))},makeEmptyItem:function(){return p.getView("")},disableAddKey:function(){this.disabledAddKey=true;return this}});var a=b.extend({tagName:"ol",dataType:"array",addText:"Add a row",arrayBias:1,initialize:function(r,q){this.originalValue=q;r=this._choose(r,q);this.valueViews=o(r).chain().map(function(s){return p.getView(s)}).map(function(s){s.bind("pop",this.removeKey,this);return s},this).value()},getValue:function(){return o.map(this.valueViews,function(q){return q.getValue()})}});var j=b.extend({tagName:"ul",dataType:"object",addText:"Add a key",arrayBias:0,initialize:function(r,q){this.originalValue=q;r=this._choose(r,q);this.valueViews=o(r).chain().keys().map(function(s){return new l(s,r[s])}).map(function(s){s.bind("pop",this.removeKey,this);return s},this).value()},makeEmptyItem:function(){return new l("","")},getValue:function(){return o(this.valueViews).chain().map(function(q){return q.getValue()}).objectify().value()}});var c=n.View.extend({tagName:"label",initialize:function(q){this.editView=new f(q);this.editView.bind("change",this.update.bind(this))},update:function(){this.$el.empty().text(this.editView.getValue())},edit:function(){this.$el.text("").append(this.editView.el).focus()},render:function(){this.$el.dblclick(this.edit.bind(this));if(this.editView.getValue()==""){this.edit()}else{this.update()}return this},getValue:function(){return this.editView.getValue()}});var l=n.View.extend({tagName:"dd",initialize:function(q,r){this.keyView=new c(q);this.valueView=p.getView(r);this.valueView.bind("pop",this.trigger.bind(this,"pop",this))},render:function(){this.$el.append(e("<dl />").append(this.keyView.render().el).append(":")).append(e("<dt />").append(this.valueView.render().el));return this},getValue:function(){return[this.keyView.getValue(),this.valueView.getValue()]}});var i=n.View.extend({tagName:"div",initialize:function(q){this.view=q.view},dataTypes:function(){var q=o([["null","null",h],["boolean","bool",g],["number","123",k],["string","abc",f],["array","[ ]",a],["object","{ }",j]]).chain().map(function(r){return[o.first(r),o.rest(r)]}).objectify().value();return q}(),render:function(){el=e("<div />",{"class":"json-mte btn-group"}).appendTo(this.el);o.each(this.dataTypes,function(q,r){var s=e("<button />",{text:q[0],"class":"btn btn-mini"}).click(o.bind(this.transpose,this,q[1])).appendTo(el);if(r==this.view.dataType){s.addClass("selected")}},this);e("<button />",{text:"X","class":"btn btn-danger btn-mini"}).click(this.trigger.bind(this,"pop",this)).appendTo(el);this.$el.addClass("json-multiedit").append(this.view.render().el);return this},getValue:function(){return this.view.getValue()},disableAddKey:function(){this.view.complex&&this.view.disableAddKey();return this},transpose:function(q){this.view=new q(this.view.getValue(),this.view.originalValue);this.$el.empty();this.render()}});var m=n.View.extend({tagName:"textarea",initialize:function(q){this.value=q},render:function(){this.$el.attr("value",JSON.stringify(this.value,null,4));return this},getValue:function(){return JSON.parse(this.el.value)}});var p=d.extend({className:"json-edit json",initialize:function(r,q){this.value=r;this.view=null;this.shown="";this.noAddKey=Boolean(q)},getValue:function(){return this.view.getValue()},showText:function(){if(this.shown=="text"){return}this.shown="text";this.updateValue();this.view=new m(this.value);this.updateView()},showBuilder:function(){if(this.shown=="builder"){return}this.shown="builder";this.updateValue();this.view=p.getView(this.value);if(this.noAddKey){this.view.disableAddKey()}this.updateView()},updateValue:function(){this.value=this.view?this.view.getValue():this.value},updateView:function(){this.$(".json-edit-body").empty().append(this.view.render().el)},render:function(){this.$el.append(e("<div />",{"class":"json-edit-header btn-group","data-toggle":"buttons-radio"}).append(e("<button />",{"class":"btn",text:"Text"}).click(this.showText.bind(this))).append(e("<button />",{"class":"btn",text:"Builder"}).button("toggle").click(this.showBuilder.bind(this)))).append(e("<div />",{"class":"json-edit-body"})).append(e("<div />").append(e("<input />",{value:"Valider","class":"btn-primary"})).click(this.validate.bind(this)));this.showBuilder();return this},validate:function(){this.trigger("validate",this.getValue())}},{getView:function(r){var q=d._getView.call(this,r);return new i({view:new q(r,r)})},viewsMap:[[o.isBoolean,g],[o.isNull,h],[o.isArray,a],[o.isNumber,k],[o.isString,f]],defaultView:j});return p});define("json/viewer",["Backbone","underscore","jQuery"],function(f,h,e){var a=f.View.extend({tagName:"span",className:"json-simple",viewName:"simple",complex:false,initialize:function(j){this.value=String(j)},render:function(){this.$el.text(this.value);return this}});var c=a.extend({viewName:"empty",initialize:function(j){this.value="?";h.any([[h.isNull,"null"],[h.isString,"Empty String"],[h.isArray,"Empty Array"],[h.bind(h.identity,h,true),"Empty Object"]],function(k){if(k[0](j)){this.value=k[1];return true}return false},this)}});var g=f.View.extend({tagName:"ol",viewName:"array",complex:true,initialize:function(j){this.listViews=h.map(j,b.getView,b)},render:function(){h.each(this.listViews,function(j){e("<li />").append(j.render().el).appendTo(this.el)},this);return this}});var d=f.View.extend({viewName:"key",complex:false,tagName:"li",initialize:function(j,k){this.key=j;this.valueView=b.getView(k)},render:function(){if(this.valueView.complex){e("<dd />").append(e("<dl />",{"class":"json-key",text:this.key})).append(e("<dt />").append(this.valueView.render().el)).appendTo(this.el)}else{e("<div />").append(e("<span />",{"class":"json-key",text:this.key})).append(" ").append(this.valueView.render().el).appendTo(this.el)}return this}});var i=f.View.extend({tagName:"ul",viewName:"object",complex:true,initialize:function(j){this.keyViews=h.map(h.keys(j),function(k){return new d(k,j[k])})},render:function(){h.each(this.keyViews,function(j){this.$el.append(j.render().el)},this);return this}});var b=f.View.extend({className:"json-object json",tagName:"div",initialize:function(j){this.inside=this.constructor.getView(j)},render:function(){this.$el.append(this.inside.render().el);return this}},{_getView:function(j){for(x in this.viewsMap){if(this.viewsMap[x][0](j)){return this.viewsMap[x][1]}}return this.defaultView},getView:function(k){var j=this._getView(k);return new j(k)},viewsMap:[[h.isBoolean,a],[h.isNumber,a],[h.isNull,c],[h.isEmpty,c],[h.isString,a],[h.isArray,g]],defaultView:i});return b});