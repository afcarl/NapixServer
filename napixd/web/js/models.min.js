"use strict";define("models/history",["Backbone","localstorage"],function(d,b){var c=d.Model.extend({defaults:{command:""}});var a=d.Collection.extend({model:c,localStorage:new b("history"),hasMore:function(e){return this.length>=e+2},push:function(e){this.create({command:e},{at:0})}});return new a()});"use strict";define("models/credentials",["selecteditem","localstorage"],function(b,d){var a=b.Model.extend({defaults:{login:"login",pass:"secret",selected:false},validate:function(){if(!(this.get("login")&&this.get("pass"))){return"You need to define a login and a pass"}},toString:function(){return this.get("login")}});var c=b.Collection.extend({model:a,localStorage:new d("credentials")});return new c()});"use strict";define("selecteditem",["Backbone","underscore"],function(d,a){var b=d.Model.extend({select:function(){if(!this.get("selected")){this.set({selected:true});this.collection.select(this);this.save()}return this}});var c=d.Collection.extend({initialize:function(){this.bind("reset",this.sendSelect,this);this._selected=null},select:function(e){this._selected=e;a.each(this.without(e),function(f){f=f.set({selected:false});if(f){f.save()}});this.trigger("select",e)},sendSelect:function(){var e=this.find(function(f){return f.get("selected")});if(e){this.select(e)}},selected:function(){return this._selected}});return{Model:b,Collection:c}});"use strict";define("models/consoleentries",["Backbone","localstorage"],function(d,c){var b=d.Model.extend({defaults:{text:"",level:"info"}});var a=d.Collection.extend({model:b,localStorage:new c("console")});return new a()});"use strict";define("models/servers",["selecteditem","localstorage"],function(b,d){var c=b.Model.extend({defaults:{host:"localhost",selected:false},validate:function(){if(!this.get("host")){return"You need to define an host"}},toString:function(){return this.get("host")}});var a=b.Collection.extend({model:c,localStorage:new d("servers")});return new a()});"use strict";define("napixclient",["Backbone","underscore","jQuery","models/servers","models/credentials","jsSHA"],function(i,j,d,f,e,h){var g=function(k){return function(l,m,n){k.success(l,k,n)}};var b=function(l,k){return function(o,n,m){l(m,k,o)}};var a=function(k){this.suffix=k;this._resources={}};a.prototype={getResource:function(k,l){if(this._resources[k]&&j.isArray(this._resources[k])){this._resources[k].push(l)}else{if(this._resources[k]){j.defer(l,this._resources[k])}else{this._resources[k]=[l];c.GET(k+this.suffix,j.bind(this.gotResource,this,k))}}},gotResource:function(l,k){j.each(this._resources[l],function(m){m(k)});this._resources[l]=k},renew:function(){this._resources={}}};var c={napix:null,_levels:new a("/_napix_help"),_newObjects:new a("/_napix_new"),_noAuth:false,_server:null,_credentials:{},setConnection:function(m,k,l){this._server=m;this._credentials={login:k,key:l};this._noAuth=l==="_napix_noauth";return this},getConnectionString:function(){return this._credentials.login+"@"+this._server},make:function(){this._levels.renew();this._newObjects.renew();if(f.selected()&&e.selected()){this.setConnection(f.selected().get("host"),e.selected().get("login"),e.selected().get("pass"));this.trigger("change",this)}},GET:function(l,m,k){this._request("GET",l,null,m,k)},HEAD:function(l,m,k){this._request("HEAD",l,null,m,k)},PUT:function(m,k,n,l){this._request("PUT",m,k,n,l)},POST:function(m,k,n,l){this._request("POST",m,k,n,l)},DELETE:function(l,m,k){this._request("DELETE",l,null,m,k)},onError:function(k,l,m){this.trigger("error",(m.getResponseHeader("content-type")==="application/json"&&JSON.parse(m.responseText))||(m.getResponseHeader("content-type")==="text/html"&&d(m.responseText))||m.responseText,l,m)},getLevel:function(k,l){return this._levels.getResource(k,l)},getNewObject:function(k,l){return this._newObjects.getResource(k,l)},getGenericLevel:function(l,m){var k=l.split("/");k.pop();k.push("*");return this.getLevel(k.join("/"),m)},sign:function(m,k){var l=new h(m,"ASCII");return l.getHMAC(k,"ASCII","SHA-256","HEX")},getAuthorization:function(k){if(this._noAuth){return""}return this._getAuthorization(k)},_getAuthorization:function(n){var m={login:this._credentials.login,nonce:this.getNonce(),host:n.host,path:n.uri,method:n.method,timestamp:String(Math.floor(Date.now()/1000))};var k=this._encodeParams(m);var l=this.sign(k,this._credentials.key);return k+":"+l},_encodeParams:function(m){var k=[];var l;for(l in m){k.push(l+"="+escape(m[l]))}return k.join("&")},getNonce:function(){return j.map(j.range(8),function(){return(((1+Math.random())*65536)|0).toString(16)}).join("")},_request:function(p,m,n,o,l){var k={method:p,uri:m,data:n,host:this._server,success:o,fail:l};this.request(k)},request:function(k){d.ajax({url:("http://"+k.host+k.uri)+(this._noAuth?"?authok":""),type:k.method,data:k.data&&JSON.stringify(k.data),dataType:"json",contentType:"application/json",success:g(k),error:b(k.fail||this.onError.bind(this),k),headers:{Authorization:this.getAuthorization(k)}})}};j.extend(c,i.Events);f.bind("select",c.make,c);e.bind("select",c.make,c);return c});