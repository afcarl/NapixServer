define("models/history",["Backbone","localstorage"],function(d,b){var c=d.Model.extend({defaults:{command:""}});var a=d.Collection.extend({model:c,localStorage:new b("history"),hasMore:function(e){return this.length>=e+2},push:function(e){this.create({command:e},{at:0})}});return new a()});define("models/credentials",["selecteditem","localstorage"],function(b,d){var a=b.Model.extend({defaults:{login:"login",pass:"secret",selected:false},validate:function(){if(!(this.get("login")&&this.get("pass"))){return"You need to define a login and a pass"}},toString:function(){return this.get("login")}});var c=b.Collection.extend({model:a,localStorage:new d("credentials")});return new c()});define("models/consoleentries",["Backbone","localstorage"],function(d,c){var b=d.Model.extend({defaults:{text:"",level:"info"}});var a=d.Collection.extend({model:b,localStorage:new c("console")});return new a()});define("models/servers",["selecteditem","localstorage"],function(b,d){var c=b.Model.extend({defaults:{host:"localhost",selected:false},validate:function(){if(!this.get("host")){return"You need to define an host"}},toString:function(){return this.get("host")}});var a=b.Collection.extend({model:c,localStorage:new d("servers")});return new a()});define("napixclient",["Backbone","underscore","jQuery","models/servers","models/credentials","jsSHA"],function(h,i,d,f,e,j){var a=function(k){this.suffix=k,this._resources={}};a.prototype={getResource:function(k,l){if(this._resources[k]&&i.isArray(this._resources[k])){this._resources[k].push(l)}else{if(this._resources[k]){i.defer(l,this._resources[k])}else{this._resources[k]=[l];c.GET(k+this.suffix,i.bind(this.gotResource,this,k))}}},gotResource:function(l,k){i.each(this._resources[l],function(m){m(k)});this._resources[l]=k},renew:function(){this._resources={}}};var c={napix:null,_levels:new a("/_napix_help"),_newObjects:new a("/_napix_new"),_noAuth:false,_server:null,_credentials:{},setConnection:function(m,k,l){this._server=m;this._credentials={login:k,key:l};this._noAuth=l=="_napix_noauth";return this},getConnectionString:function(){return this._credentials.login+"@"+this._server},make:function(){this._levels.renew();this._newObjects.renew();if(f.selected()&&e.selected()){this.setConnection(f.selected().get("host"),e.selected().get("login"),e.selected().get("pass"));this.trigger("change",this)}},GET:function(l,m,k){this.request("GET",l,null,m,k)},HEAD:function(l,m,k){this.request("HEAD",l,null,m,k)},PUT:function(m,k,n,l){this.request("PUT",m,k,n,l)},POST:function(m,k,n,l){this.request("POST",m,k,n,l)},DELETE:function(l,m,k){this.request("DELETE",l,null,m,k)},request:function(o,m,k,n,l){this.request(o,m,k,n,l||this.onError.bind(this))},onError:function(k,l,m){this.trigger("error",m.getResponseHeader("content-type")=="application/json"&&JSON.parse(m.responseText)||m.getResponseHeader("content-type")=="text/html"&&d(m.responseText)||m.responseText,l,m)},getLevel:function(k,l){return this._levels.getResource(k,l)},getNewObject:function(k,l){return this._newObjects.getResource(k,l)},getGenericLevel:function(l,m){var k=l.split("/");k.pop();k.push("*");return this.getLevel(k.join("/"),m)},sign:function(m,k){var l=new j(m,"ASCII");return l.getHMAC(k,"ASCII","SHA-256","HEX")},getAuthorization:function(k){if(this._noAuth){return""}return this._getAuthorization(k.method,k.uri)},_getAuthorization:function(o,n){var m={login:this._credentials.login,nonce:this.getNonce(),host:this._server,path:n,method:o,timestamp:String(Math.floor(Date.now()/1000))};var k=this._encodeParams(m);var l=this.sign(k,this._credentials.key);return k+":"+l},_encodeParams:function(l){tail=[];for(var k in l){tail.push(k+"="+escape(l[k]))}return tail.join("&")},getNonce:function(){return i.map(i.range(8),function(){return(((1+Math.random())*65536)|0).toString(16)}).join("")},request:function(p,m,n,o,l){var k={method:p,uri:m,data:n,host:this._server};d.ajax({url:("http://"+this._server+m)+(this._noAuth?"?authok":""),type:p,data:n&&JSON.stringify(n),dataType:"json",contentType:"application/json",success:g(o,k),error:b(l||this.onError.bind(this),k),headers:{Authorization:this.getAuthorization(k)}})}};var g=function(l,k){return function(m,n,o){l(m,k,o)}};var b=function(l,k){return function(o,n,m){l(m,k,o)}};i.extend(c,h.Events);f.bind("select",c.make,c);e.bind("select",c.make,c);return c});