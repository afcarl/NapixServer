define("models/history",["Backbone","localstorage"],function(d,b){var c=d.Model.extend({defaults:{command:""}});var a=d.Collection.extend({model:c,localStorage:new b("history"),hasMore:function(e){return this.length>=e+2},push:function(e){this.create({command:e},{at:0})}});return new a()});define("models/credentials",["selecteditem","localstorage"],function(b,d){var a=b.Model.extend({defaults:{login:"login",pass:"secret",selected:false},validate:function(){if(!(this.get("login")&&this.get("pass"))){return"You need to define a login and a pass"}}});var c=b.Collection.extend({model:a,localStorage:new d("credentials")});return new c()});define("models/consoleentries",["Backbone","localstorage"],function(d,c){var b=d.Model.extend({defaults:{text:"",level:"info"}});var a=d.Collection.extend({model:b,localStorage:new c("console")});return new a()});define("models/servers",["selecteditem","localstorage"],function(b,d){var c=b.Model.extend({defaults:{host:"localhost",selected:false},validate:function(){if(!this.get("host")){return"You need to define an host"}}});var a=b.Collection.extend({model:c,localStorage:new d("servers")});return new a()});define("napixclient",["Backbone","underscore","jQuery","models/servers","models/credentials","jsSHA"],function(h,b,e,f,d,c){var a=function(i){this.suffix=i,this._resources={}};a.prototype={getResource:function(i,j){if(this._resources[i]&&b.isArray(this._resources[i])){this._resources[i].push(j)}else{if(this._resources[i]){b.defer(j,this._resources[i])}else{this._resources[i]=[j];g.GET(i+this.suffix,b.bind(this.gotResource,this,i))}}},gotResource:function(j,i){b.each(this._resources[j],function(k){k(i)});this._resources[j]=i},renew:function(){this._resources={}}};var g={napix:null,_levels:new a("/_napix_help"),_newObjects:new a("/_napix_new"),_noAuth:false,_server:null,_credentials:{},setConnection:function(k,i,j){this._server=k;this._credentials={login:i,key:j};this._noAuth=j=="_napix_noauth";return this},getConnectionString:function(){return this._credentials.login+"@"+this._server},make:function(){this._levels.renew();this._newObjects.renew();if(f.selected()&&d.selected()){this.setConnection(f.selected().get("host"),d.selected().get("login"),d.selected().get("pass"));this.trigger("change",this)}},GET:function(j,k,i){this.request("GET",j,null,k,i)},HEAD:function(j,k,i){this.request("HEAD",j,null,k,i)},PUT:function(k,i,l,j){this.request("PUT",k,i,l,j)},POST:function(k,i,l,j){this.request("POST",k,i,l,j)},DELETE:function(j,k,i){this.request("DELETE",j,null,k,i)},request:function(m,k,i,l,j){this.request(m,k,i,l,j||this.onError.bind(this))},onError:function(i){this.trigger("error",i.status,i.statusText,i.getResponseHeader("content-type")=="application/json"&&JSON.parse(i.responseText)||i.getResponseHeader("content-type")=="text/html"&&e(i.responseText)||i.responseText)},getLevel:function(i,j){return this._levels.getResource(i,j)},getNewObject:function(i,j){return this._newObjects.getResource(i,j)},getGenericLevel:function(j,k){var i=j.split("/");i.pop();i.push("*");return this.getLevel(i.join("/"),k)},sign:function(k,i){var j=new c(k,"ASCII");return j.getHMAC(i,"ASCII","SHA-256","HEX")},getAuthorization:function(j,i){if(this._noAuth){return""}return this._getAuthorization(j,i)},_getAuthorization:function(m,l){var k={login:this._credentials.login,nonce:this.getNonce(),host:this._server,path:l,method:m,timestamp:String(Math.floor(Date.now()/1000))};var i=this._encodeParams(k);var j=this.sign(i,this._credentials.key);return i+":"+j},_encodeParams:function(j){tail=[];for(var i in j){tail.push(i+"="+escape(j[i]))}return tail.join("&")},getNonce:function(){return b.map(b.range(8),function(){return(((1+Math.random())*65536)|0).toString(16)}).join("")},request:function(m,j,k,l,i){e.ajax({url:("http://"+this._server+j)+(this._noAuth?"?authok":""),type:m,data:k&&JSON.stringify(k),dataType:"json",contentType:"application/json",success:l,error:i||this.onError.bind(this),headers:{Authorization:this.getAuthorization(m,j)}})}};b.extend(g,h.Events);f.bind("select",g.make,g);d.bind("select",g.make,g);return g});