define(["underscore","views/json/multitype"],function(e,t){var n=function(e){this.viewsMap=e.views};n.prototype={getViewClass:function(t){return e.find(this.viewsMap,function(e){return e.detect(t)})},getView:function(e){var t=this.getViewClass(e);return new t({value:e,finder:this})}};var r=function(e){return n.call(this,e),this.fixedViewsMap=e.fixedViews||[],this.typesMap=e.typesMap||{},this};return e.extend(r.prototype,n.prototype,{getView:function(n,r,i){var s,o=!0,u="";e.isString(r)&&(o=r.indexOf(";optional")!==-1,u=r.split(";").shift());var a=!0;e.isArray(r)||e.isObject(r)?(s=this.getFixedViewClass(r),a=!1):e.isString(r)&&u?s=this.getViewClassByType.call(this,u):s=this.getViewClass(n);var f=new s({value:n,originalValue:e.isUndefined(i)?n:i,types:r,finder:this});return a?new t({finder:this,view:f,poppable:o,changeable:u===""}):f},getDefaultViewClass:function(){return this.getViewClassByType("default")},getFixedViewClass:function(t){return e.find(this.fixedViewsMap,function(e){return e.detect(t)})},getViewClassByType:function(t){return t=this.typesMap[t]||t,e.find(this.viewsMap,function(e){return e.prototype.dataType===t})}}),{viewer:n,editor:r}})